#################################################################
# teamName used for argocd applicaiton names and namespace names.
#################################################################
teamName: cluster-config
#################################################################
# default Values for app-of-apps-infrastructure helm chart
#################################################################
defaults:
  # argcod application defaults
  finalizers: resources-finalizer.argocd.argoproj.io
  gitopsNamespace: openshift-gitops
  # Helm defaults
  helmRepoUrl: https://rosa-hcp-dedicated-vpc.github.io/helm-repository/
  path: charts
  # Vault plugin defaults.
  plugin: true
  AWS_REGION: "ap-southeast-4"
  AVP_TYPE: "awssecretsmanager"
#################################################################
# INFRASTRUCTURE Charts to be deployed.
#################################################################
infrastructure:
  - chart: cluster-efs
    targetRevision: 0.4.12
    namespace: openshift-cluster-csi-drivers
    values:
      roleArn: arn:aws:iam::808082629126:role/np-hub-rosa-efs-csi-role-iam
      fileSystemId: fs-0718beb50be783f1e
      helper-operator:
        startingCSV: aws-efs-csi-driver-operator.v4.19.0-202509292054
  - chart: compliance-operator
    targetRevision: 1.2.10
    namespace: openshift-compliance
    values:
      helper-operator:
        startingCSV: compliance-operator.v1.7.1
  - chart: overprovisioning
    targetRevision: 0.0.7
    namespace: overprovisioning
    values:
  - chart: cluster-logging
    targetRevision: 0.5.10
    namespace: openshift-logging
    values:
      roleArn: arn:aws:iam::808082629126:role/np-hub-rosa-cloudwatch-role-iam
      region: ap-southeast-2
      helper-operator:
        startingCSV: cluster-logging.v6.2.3
  - chart: acm-operator
    targetRevision: 0.2.13
    namespace: open-cluster-management
    annotations:
      argocd.argoproj.io/compare-options: IgnoreExtraneous
    values:
      helper-operator:
        startingCSV: advanced-cluster-management.v2.13.4
  - chart: rhdh-helm
    targetRevision: 1.2.4
    namespace: backstage
    values:
      redhat-developer-hub:
        global:
          clusterRouterBase: apps.rosa.np-hub.nosu.p3.openshiftapps.com
        upstream:
          backstage:
            extraContainers:
              - name: oauth2-proxy
                env:
                  - name: OAUTH2_PROXY_CLIENT_ID
                    valueFrom:
                      secretKeyRef:
                        key: CLIENT_ID
                        name: keycloak-client-secret-backstage
                  - name: OAUTH2_PROXY_CLIENT_SECRET
                    valueFrom:
                      secretKeyRef:
                        key: CLIENT_SECRET
                        name: keycloak-client-secret-backstage
                  - name: OAUTH2_PROXY_COOKIE_SECRET
                    value: "{{ randAlpha 32 | lower | b64enc }}"
                  - name: OAUTH2_PROXY_OIDC_ISSUER_URL
                    value: https://keycloak-rhsso-operator.apps.rosa.np-hub.nosu.p3.openshiftapps.com/auth/realms/backstage
                  - name: OAUTH2_PROXY_SSL_INSECURE_SKIP_VERIFY
                    value: 'true'
                ports:
                  - name: oauth2-proxy
                    containerPort: 4180
                    protocol: TCP
                imagePullPolicy: IfNotPresent
                image: 'quay.io/oauth2-proxy/oauth2-proxy:latest'
                args:
                  - '--provider=oidc'
                  - '--email-domain=*'
                  - '--upstream=http://localhost:7007'
                  - '--http-address=0.0.0.0:4180'
                  - '--skip-provider-button'
                  - '--insecure-oidc-allow-unverified-email=true' 
            appConfig:
              app:
                baseUrl: https://backstage-backstage.apps.rosa.np-hub.nosu.p3.openshiftapps.com
              backend:
                baseUrl: https://backstage-backstage.apps.rosa.np-hub.nosu.p3.openshiftapps.com
                cors:
                  origin: https://backstage-backstage.apps.rosa.np-hub.nosu.p3.openshiftapps.com
                reading:
                  allow:
                    - host: '*.apps.rosa.np-hub.nosu.p3.openshiftapps.com'
              catalog:
                locations:
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/tree/main/charts/rhdh-helm/files/showcase-templates.yaml
                    type: url
                    rules:
                      - allow: [Template]
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/tree/main/charts/rhdh-helm/files/org.yaml
                    type: url
                    rules:
                      - allow: [Group, User]
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/tree/main/charts/rhdh-helm/files/showcase-templates.yaml
                    type: url
                    rules:
                      - allow: [Template]
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/tree/main/charts/rhdh-helmfiles/locations.yaml
                    type: url
                    rules:
                      - allow: [Domain, Component, System, API, Resource, Location]
              kubernetes:
              clusterLocatorMethods:
                - type: "config"
                  clusters:
                    - name: dev-cluster-infra
                      url: https://api.rosa.np-hub.nosu.p3.openshiftapps.com:6443
        route:
          host: backstage-backstage.apps.rosa.np-hub.nosu.p3.openshiftapps.com
  - chart: rhdh-orchestrator-infra
    targetRevision: 2.0.5
    namespace: openshift-serverless
  - chart: rhdh-orchestrator-workflows-greeting
    targetRevision: 2.0.7
    namespace: backstage
  - chart: rhsso-operator
    targetRevision: 0.2.1
    namespace: rhsso-operator
    values:
      clientSecret: "np-hub-secret-2"

  # - chart: orchestrator-operator
  #   targetRevision: 1.0.2
  #   namespace: openshift-operators
  #   values:
  #     helper-operator:
  #       startingCSV: orchestrator-operator.v1.6.1
  # - chart: backstage
  #   targetRevision: 4.5.14
  #   namespace: backstage
  #   annotations:
  #     argocd.argoproj.io/compare-options: IgnoreExtraneous
  #   values:
  #     global:
  #       host: "cluster-config-backstage-developer-hub-backstage.apps.rosa.np-hub.pcx9.p3.openshiftapps.com"
  # - chart: backstage
  #   targetRevision: 4.5.14
  #   namespace: backstage
  #   annotations:
  #     argocd.argoproj.io/compare-options: IgnoreExtraneous
  #   values:
  #     global:
  #       host: "cluster-config-backstage-developer-hub-backstage.apps.rosa.np-hub.pcx9.p3.openshiftapps.com"

  # - chart: orchestrator-software-templates-infra
  #   targetRevision: 0.2.6
  #   namespace: openshift-operators
  #   values:
  #     startingCSV: advanced-cluster-management.v2.13.4


  # - chart: rhacs-operator
  #   targetRevision: 0.1.8
  #   namespace: rhacs-operator
  #   values:
  #     helper-operator:
  #       startingCSV: rhacs-operator.v4.7.4
        
