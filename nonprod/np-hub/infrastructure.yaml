#################################################################
# teamName used for argocd applicaiton names and namespace names.
#################################################################
teamName: cluster-config
#################################################################
# default Values for app-of-apps-infrastructure helm chart
#################################################################
defaults:
  # argcod application defaults
  clusterName: np-hub
  finalizers: resources-finalizer.argocd.argoproj.io
  gitopsNamespace: openshift-gitops
  # Helm defaults
  helmRepoUrl: https://rosa-hcp-dedicated-vpc.github.io/helm-repository/
  path: charts
  # Vault plugin defaults.
  plugin: true
  AWS_REGION: "ap-southeast-4"
  AVP_TYPE: "awssecretsmanager"
#################################################################
# INFRASTRUCTURE Charts to be deployed.
#################################################################
infrastructure:
  - chart: cluster-efs
    targetRevision: 0.4.12
    namespace: openshift-cluster-csi-drivers
    values:
      roleArn: arn:aws:iam::808082629126:role/np-hub-rosa-efs-csi-role-iam
      fileSystemId: fs-0718beb50be783f1e
      helper-operator:
        startingCSV: aws-efs-csi-driver-operator.v4.20.0-202511040554
  - chart: compliance-operator
    targetRevision: 1.2.10
    namespace: openshift-compliance
    values:
      helper-operator:
        startingCSV: compliance-operator.v1.7.1
  - chart: overprovisioning
    targetRevision: 0.0.7
    namespace: overprovisioning
    values:
  - chart: cluster-logging
    targetRevision: 0.5.10
    namespace: openshift-logging
    values:
      roleArn: arn:aws:iam::808082629126:role/np-hub-rosa-cloudwatch-role-iam
      region: ap-southeast-2
      helper-operator:
        startingCSV: cluster-logging.v6.2.3
  - chart: acm-operator
    targetRevision: 0.5.12
    namespace: open-cluster-management
    annotations:
      argocd.argoproj.io/compare-options: IgnoreExtraneous
    values:
      helper-operator:
        startingCSV: advanced-cluster-management.v2.14.1
  - chart: rhdh-helm
    targetRevision: 1.11.5
    namespace: backstage
    values:
      # Quay/Red Hat Pull Secret - Retrieved from AWS Secrets Manager via ArgoCD Vault Plugin
      quayPullSecret: "<path:np-hub-secret-5#dockerconfigjson>"
      # GitHub App Credentials - Retrieved from AWS Secrets Manager via ArgoCD Vault Plugin
      github:
        appId: "<path:np-hub-secret-3#appId>"
        clientId: "<path:np-hub-secret-3#clientId>"
        clientSecret: "<path:np-hub-secret-3#clientSecret>"
        webhookSecret: "<path:np-hub-secret-3#webhookSecret>"
        webhookUrl: "<path:np-hub-secret-3#webhookUrl>"
        privateKey: "<path:np-hub-secret-3#privateKey>"
      keycloakUrl: https://keycloak-rhbk-operator.apps.rosa.np-hub.alde.p3.openshiftapps.com
      # Lightspeed AI Assistant Configuration (DISABLED BY DEFAULT)
      lightspeed:
        enabled: false  # Set to true to enable Lightspeed AI assistant
        vllmUrl: "<path:np-hub-secret-4#vllmUrl>"
        vllmApiKey: "<path:np-hub-secret-4#vllmApiKey>"
        validationProvider: "<path:np-hub-secret-4#validationProvider>"
        validationModelName: "<path:np-hub-secret-4#validationModelName>"
        mcpToken: "<path:np-hub-secret-4#mcpToken>"
        postgres:
          enabled: false  # Set to true to enable PostgreSQL for Lightspeed
          namespace: lightspeed-postgres
          image: registry.redhat.io/rhel9/postgresql-16:latest
          storageSize: 5Gi
          user: "<path:np-hub-secret-4#lightspeedPostgresUser>"
          password: "<path:np-hub-secret-4#lightspeedPostgresPassword>"
          dbName: "<path:np-hub-secret-4#lightspeedPostgresDb>"
      # Model Catalog Configuration (DISABLED BY DEFAULT)
      modelCatalog:
        enabled: false  # Set to true to enable model catalog integration with RHOAI
      # Kubernetes Cluster Reader (DISABLED BY DEFAULT)
      kubernetes:
        clusterReaderEnabled: false  # Set to true to enable cluster reader permissions
      # Sidecars for Lightspeed and Model Catalog (DISABLED BY DEFAULT)
      sidecars:
        enabled: false  # Set to true to enable sidecar containers
        serviceAccount: default
        image: quay.io/redhat-ai-dev/utils:latest
        locationImage: quay.io/redhat-ai-dev/model-catalog-location-service:latest
        storageRestImage: quay.io/redhat-ai-dev/model-catalog-storage-rest:latest
        rhoaiNormalizerImage: quay.io/redhat-ai-dev/model-catalog-rhoai-normalizer:latest
        llamaStackImage: quay.io/redhat-ai-dev/llama-stack:0.1.0
        lightspeedCoreImage: quay.io/lightspeed-core/lightspeed-stack:dev-20251021-ee9f08f
        feedbackHarvesterImage: quay.io/redhat-ai-dev/feedback-harvester:v0.1.0
      consoleLink:
        enabled: true
        url: https://backstage-backstage.apps.rosa.np-hub.alde.p3.openshiftapps.com
        text: "Red Hat Developer Hub"
        section: "Developer Tools"
      redhat-developer-hub:
        global:
          clusterRouterBase: apps.rosa.np-hub.alde.p3.openshiftapps.com
        upstream: 
          backstage:
            extraEnvVars:
              - name: KEYCLOAK_CLIENT_ID
                value: backstage
              - name: KEYCLOAK_CLIENT_SECRET
                valueFrom:
                  secretKeyRef:
                    key: CLIENT_SECRET
                    name: keycloak-client-secret-backstage
              - name: BACKEND_SECRET
                value: "{{ randAlphaNum 24 | b64enc }}"
              - name: K8S_SERVICE_ACCOUNT_TOKEN
                valueFrom:
                  secretKeyRef:
                    key: token
                    name: backstage-k8s-token
              - name: GITHUB_APP_ID
                valueFrom:
                  secretKeyRef:
                    key: GITHUB_APP_ID
                    name: github-app-credentials
              - name: GITHUB_CLIENT_ID
                valueFrom:
                  secretKeyRef:
                    key: GITHUB_CLIENT_ID
                    name: github-app-credentials
              - name: GITHUB_CLIENT_SECRET
                valueFrom:
                  secretKeyRef:
                    key: GITHUB_CLIENT_SECRET
                    name: github-app-credentials
              - name: GITHUB_WEBHOOK_SECRET
                valueFrom:
                  secretKeyRef:
                    key: GITHUB_WEBHOOK_SECRET
                    name: github-app-credentials
              - name: GITHUB_WEBHOOK_URL
                valueFrom:
                  secretKeyRef:
                    key: GITHUB_WEBHOOK_URL
                    name: github-app-credentials
              - name: GITHUB_PRIVATE_KEY
                valueFrom:
                  secretKeyRef:
                    key: GITHUB_PRIVATE_KEY
                    name: github-app-credentials
              - name: LOG_LEVEL
                value: debug
              # Disable TLS verification (for development/testing only - NOT recommended for production)
              - name: NODE_TLS_REJECT_UNAUTHORIZED
                value: "0"
              # Lightspeed/MCP Configuration (only used if lightspeed.enabled: true)
              - name: MCP_TOKEN
                valueFrom:
                  secretKeyRef:
                    key: mcpToken
                    name: lightspeed-mcp-token
              - name: VLLM_URL
                valueFrom:
                  secretKeyRef:
                    key: VLLM_URL
                    name: llama-stack-secrets
              - name: VLLM_API_KEY
                valueFrom:
                  secretKeyRef:
                    key: VLLM_API_KEY
                    name: llama-stack-secrets
              - name: VALIDATION_PROVIDER
                valueFrom:
                  secretKeyRef:
                    key: VALIDATION_PROVIDER
                    name: llama-stack-secrets
              - name: VALIDATION_MODEL_NAME
                valueFrom:
                  secretKeyRef:
                    key: VALIDATION_MODEL_NAME
                    name: llama-stack-secrets
            appConfig:
              app:
                title: AI Rolling Demo Developer Hub
                baseUrl: https://backstage-backstage.apps.rosa.np-hub.alde.p3.openshiftapps.com
                analytics:
                  adoptionInsights:
                  maxBufferSize: 20
                  flushInterval: 5000
                  debug: false
                  licensedUsers: 50
              backend:
                baseUrl: https://backstage-backstage.apps.rosa.np-hub.alde.p3.openshiftapps.com
                cors:
                  origin: https://backstage-backstage.apps.rosa.np-hub.alde.p3.openshiftapps.com
                # MCP Actions Plugin Sources (only used if lightspeed.enabled: true)
                actions:
                  pluginSources:
                    - 'software-catalog-mcp-tool'
                    - 'techdocs-mcp-tool'
           # AI Experience config
                csp:
                  upgrade-insecure-requests: false
                  img-src:
                    - "'self'"
                    - "data:"
                    - https://img.freepik.com
                    - https://cdn.dribbble.com
                    - https://upload.wikimedia.org
                    - https://podman-desktop.io
                    - https://argo-cd.readthedocs.io
                    - https://instructlab.ai
                    - https://quay.io
                    - https://news.mit.edu
                  script-src:
                    - "'self'"
                    - "'unsafe-eval'"
                    - https://cdn.jsdelivr.net
                  connect-src:
                    - "'self'"
                    - https://api.github.com
                    - https://raw.githubusercontent.com
                    - https://github.com
                    - https://*.githubusercontent.com
                    - https://*.apps.rosa.np-hub.alde.p3.openshiftapps.com
                    - https://*.np-ai-1.p867.p3.openshiftapps.com
                reading:
                  allow:
                    - host: '*.apps.rosa.np-hub.alde.p3.openshiftapps.com'
                    - host: '*.np-ai-1.p867.p3.openshiftapps.com'
                    - host: 'raw.githubusercontent.com'
                    - host: 'github.com'
                    - host: '*.githubusercontent.com'
                    - host: '*.apps.rosa.np-ai-1.p867.p3.openshiftapps.com'
                    - host: example.com
                    - host: '*.mozilla.org'
                    - host: '*.openshift.com'
                    - host: '*.openshiftapps.com'
                    - host: '10.*:9090'
                    - host: '127.0.0.1:9090'
                    - host: '127.0.0.1:8888'
                    - host: '127.0.0.1:7070'
                    - host: 'localhost:9090'
                    - host: 'localhost:8888'
                    - host: 'localhost:7070'
                auth:
                  externalAccess:
                    - type: static
                      options:
                        token: "my-backend-secret-token-12345"
                        subject: backstage-server
                    # MCP Authentication (only used if lightspeed.enabled: true)
                    - type: static
                      options:
                        token: "$${MCP_TOKEN}"
                        subject: mcp-clients
              auth:
                environment: production
                providers:
                  oidc:
                    production:
                      metadataUrl: https://keycloak-rhbk-operator.apps.rosa.np-hub.alde.p3.openshiftapps.com/realms/backstage/.well-known/openid-configuration
                      clientId: backstage
                      clientSecret: "$${KEYCLOAK_CLIENT_SECRET}"
                      prompt: auto
                      # signIn:
                      #   resolvers:
                      #     - resolver: emailMatchingUserEntityProfileEmail
                      #     - resolver: emailLocalPartMatchingUserEntityName
                    development:
                      metadataUrl: https://keycloak-rhbk-operator.apps.rosa.np-hub.alde.p3.openshiftapps.com/realms/backstage/.well-known/openid-configuration
                      clientId: backstage
                      clientSecret: "$${KEYCLOAK_CLIENT_SECRET}"
                      prompt: auto
              session:
                secret: "$${BACKEND_SECRET}"
              signInPage: oidc
              integrations:
                github:
                  - host: github.com
                    apiBaseUrl: https://api.github.com
                    rawBaseUrl: https://raw.githubusercontent.com
                    apps:
                      - appId: "$${GITHUB_APP_ID}"
                        clientId: "$${GITHUB_CLIENT_ID}"
                        clientSecret: "$${GITHUB_CLIENT_SECRET}"
                        webhookUrl: "$${GITHUB_WEBHOOK_URL}"
                        webhookSecret: "$${GITHUB_WEBHOOK_SECRET}"
                        privateKey: |
                          $${GITHUB_PRIVATE_KEY}
              # Lightspeed MCP Servers Configuration (only used if lightspeed.enabled: true)
              lightspeed:
                mcpServers:
                  - name: mcp-integration-tools
                    token: "$${MCP_TOKEN}"
              catalog:
                locations:
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/blob/main/charts/rhdh-helm/files/showcase-templates.yaml
                    type: url
                    rules:
                      - allow: [Template]
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/blob/main/charts/rhdh-helm/files/org.yaml
                    type: url
                    rules:
                      - allow: [Group, User]
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/blob/main/charts/rhdh-helm/files/locations.yaml
                    type: url
                    rules:
                      - allow: [Domain, Component, System, API, Resource, Location]
                  - target: https://github.com/rosa-hcp-dedicated-vpc/helm-repository/blob/main/charts/rhdh-helm/ai-lab-template/all.yaml
                    type: url
                    rules:
                      - allow: [User, Group, System, Domain, Component, Resource, Location, Template, API]
                providers:
                  ocm:
                    default:
                      name: multiclusterhub
                      kubernetesPluginRef: dev-cluster-infra
                      schedule:
                        frequency: { seconds: 30 }
                        timeout: { seconds: 60 }
                      owner: group:rhdh
                  keycloakOrg:
                      default:
                        baseUrl: https://keycloak-rhbk-operator.apps.rosa.np-hub.alde.p3.openshiftapps.com
                        clientId: backstage
                        clientSecret: "$${KEYCLOAK_CLIENT_SECRET}"
                        loginRealm: backstage
                        realm: backstage
                        schedule:
                          frequency: { minutes: 1 }
                          timeout: { minutes: 5 }
                          initialDelay: { seconds: 15 }
                  github:
                    providerId:
                      organization: "rosa-hcp-dedicated-vpc"
                      schedule:
                        frequency: { minutes: 2 }
                        initialDelay: { seconds: 15 }
                        timeout: { minutes: 15 }
                  githubOrg:
                    githubUrl: https://github.com
                    orgs: ["rosa-hcp-dedicated-vpc"]
                    schedule:
                      frequency:
                        minutes: 2
                      initialDelay:
                        seconds: 15
                      timeout:
                        minutes: 15
              argocd:
                appLocatorMethods:
                  - type: 'config'
                    instances:
                      - name: application-gitops
                        url: https://application-gitops-server-application-gitops.apps.rosa.np-hub.alde.p3.openshiftapps.com
                        token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJiYWNrc3RhZ2U6YXBpS2V5IiwibmJmIjoxNzY0NDk3NDAyLCJpYXQiOjE3NjQ0OTc0MDIsImp0aSI6IjQwZGY5MDA0LTYxZjEtNDRlYi05MmIzLTY5OTU3OTczYWQ4NyJ9.Z6SIEx80oSZxbRxdOsR9NnTIXZmyJxMnrKZBYMmLyHw"
                      - name: np-ai-1-application-gitops
                        url: https://application-gitops-server-application-gitops.apps.rosa.np-ai-1.p867.p3.openshiftapps.com
                        token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJhcmdvY2QiLCJzdWIiOiJiYWNrc3RhZ2U6YXBpS2V5IiwibmJmIjoxNzY0NTQzMzAxLCJpYXQiOjE3NjQ1NDMzMDEsImp0aSI6IjllNTA2Y2RkLTUyNTEtNDQwMC04Y2MzLTI1N2M1YjE5NzUxOSJ9.vQe4w7pfXWmB9Vxj8h_UrEAFt1VrLgmxW1yXZkmGweI"
              kubernetes:
                serviceLocatorMethod:
                  type: "multiTenant"
                clusterLocatorMethods:
                  - type: "config"
                    clusters:
                      - name: dev-cluster-infra
                        url: https://api.np-hub.alde.p3.openshiftapps.com:443
                        authProvider: "serviceAccount"
                        skipTLSVerify: true
                        serviceAccountToken: "$${K8S_SERVICE_ACCOUNT_TOKEN}"
          service:
            ports:
              backend: 7007
              targetPort: backend
        route:
          host: backstage-backstage.apps.rosa.np-hub.alde.p3.openshiftapps.com
  - chart: rhdh-orchestrator-infra
    targetRevision: 2.0.7 
    namespace: openshift-serverless
  - chart: rhdh-orchestrator-workflows-greeting
    targetRevision: 2.0.8
    namespace: backstage
  - chart: rhbk-operator
    targetRevision: 0.2.7
    namespace: rhbk-operator
    values:
      clientSecret: "np-hub-secret-2"
      clusterDomain: "apps.rosa.np-hub.alde.p3.openshiftapps.com"
      consoleLink:
        enabled: true
        url: https://keycloak-rhbk-operator.apps.rosa.np-hub.alde.p3.openshiftapps.com
        text: "Red Hat Build of Keycloak"
        section: "Authentication"
      subscription:
        startingCSV: "rhbk-operator.v26.4.2-opr.1"
      client:
        redirectUri:
          - https://backstage-backstage.apps.rosa.np-hub.alde.p3.openshiftapps.com/api/auth/oidc/handler/frame

  # - chart: orchestrator-operator
  #   targetRevision: 1.0.2
  #   namespace: openshift-operators
  #   values:
  #     helper-operator:
  #       startingCSV: orchestrator-operator.v1.6.1
  # - chart: backstage
  #   targetRevision: 4.5.14
  #   namespace: backstage
  #   annotations:
  #     argocd.argoproj.io/compare-options: IgnoreExtraneous
  #   values:
  #     global:
  #       host: "cluster-config-backstage-developer-hub-backstage.apps.rosa.np-hub.pcx9.p3.openshiftapps.com"
  # - chart: backstage
  #   targetRevision: 4.5.14
  #   namespace: backstage
  #   annotations:
  #     argocd.argoproj.io/compare-options: IgnoreExtraneous
  #   values:
  #     global:
  #       host: "cluster-config-backstage-developer-hub-backstage.apps.rosa.np-hub.pcx9.p3.openshiftapps.com"

  # - chart: orchestrator-software-templates-infra
  #   targetRevision: 0.2.6
  #   namespace: openshift-operators
  #   values:
  #     startingCSV: advanced-cluster-management.v2.13.4


  # - chart: rhacs-operator
  #   targetRevision: 0.1.8
  #   namespace: rhacs-operator
  #   values:
  #     helper-operator:
  #       startingCSV: rhacs-operator.v4.7.4
        